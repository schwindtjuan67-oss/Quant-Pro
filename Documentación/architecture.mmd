flowchart LR

subgraph R[Research / Pipeline]
A1[bat/run_autoloop_A_B_C.bat]
A2[analysis/robust_optimizer.py\n(Fase A)]
A3[analysis/analysis_post_robust.py\n(Post-A)]
A4[analysis/promoter_faseA_to_B.py\n(Promoción A→B)]
B[analysis/stage_b_risk_calibration.py\n(Fase B)]
C[analysis/stage_c_pipeline_eval.py\n(Fase C)]
end

subgraph X[Artifacts Contract]
R1[results/robust/\nrobust_<window>_seed<seed>.json]
P1[results/promotions/\nfaseA_promoted.json]
P2[results/promotions/\nfaseB_promoted.json + report.csv]
P3[results/promotions/\nfaseC_promoted.json + report.csv]
T1[results/pipeline_stageC_trades/]
end

subgraph L[Shadow / Live Engine]
E1[Live/shadow_runner*.py]
E2[Live/hybrid_scalper_pro_adapter.py]
E3[Live/hybrid_scalper_pro.py\n(strategy)]
E4[Live/risk_manager.py]
E5[Live/logger_pro.py]
E6[analysis/config_state_store.py\n(state/hotswap)]
E7[Live/hybrid_param_hotswap.py\n(apply params)]
E8[Live/ws_futures_1m.py / stream_klines.py\n(data feed)]
end

A1 --> A2 --> R1
A2 --> R1
R1 --> A3 --> P1 --> A4 --> P1
P1 --> B --> P2
P2 --> C --> P3
C --> T1

P3 -->|manual selection / loader| E1
E1 -->|engine.config[params]| E2 --> E3
E3 --> E4
E3 --> E5
E6 --> E2
E7 --> E3
E8 --> E1
